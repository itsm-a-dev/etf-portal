<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin Upload</title>
</head>
<body>
  <h2>Admin Login</h2>
  <input id="email" placeholder="email"><br/>
  <input id="password" type="password" placeholder="password"><br/>
  <button id="login">Login</button>
  <p id="loginStatus"></p>

  <hr/>
  <h2>Upload Excel</h2>
  <input id="file" type="file" accept=".xlsx,.xls,.csv" />
  <button id="upload">Upload</button>
  <p id="uploadStatus"></p>

  <script>
    const API_BASE = 'etf-portal-production.up.railway.app'; // e.g. https://etf-api.up.railway.app
    let token = localStorage.getItem('token') || '';

    document.getElementById('login').onclick = async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const res = await fetch(`${API_BASE}/auth/login`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (res.ok) {
        token = data.token;
        localStorage.setItem('token', token);
        document.getElementById('loginStatus').textContent = 'Logged in';
      } else {
        document.getElementById('loginStatus').textContent = data.error || 'Login failed';
      }
    };

    document.getElementById('upload').onclick = async () => {
      if (!token) return alert('Login first');
      const f = document.getElementById('file').files[0];
      if (!f) return alert('Choose a file');

      const fd = new FormData();
      fd.append('file', f);

      const res = await fetch(`${API_BASE}/upload`, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${token}` },
        body: fd
      });
      const data = await res.json();
      document.getElementById('uploadStatus').textContent = res.ok
        ? `Uploaded ${data.count} rows`
        : (data.error || 'Upload failed');
    };
  </script>
</body>
</html>
